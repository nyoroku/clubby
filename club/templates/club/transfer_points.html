{% extends 'club/base.html' %}
{% load static %}

{% block title %}Transfer Points - Melvins Club{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 py-8 pb-24">

    <!-- Breadcrumb -->
    <a href="{% url 'club:dashboard' %}"
        class="inline-flex items-center text-sm text-melvins-dark/50 hover:text-melvins-red mb-6 transition">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Dashboard
    </a>

    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-display font-bold text-melvins-dark mb-2">ğŸ’¸ Transfer Points</h1>
        <p class="text-melvins-dark/60">Send points to friends or invite new users</p>
    </div>

    {% if messages %}
    <div class="mb-6 space-y-2">
        {% for message in messages %}
        <div class="p-4 rounded-xl flex items-start gap-3
            {% if message.tags == 'success' %}bg-green-100 text-green-800 border border-green-200
            {% elif message.tags == 'error' %}bg-red-100 text-red-800 border border-red-200
            {% else %}bg-blue-100 text-blue-800 border border-blue-200{% endif %}">
            <span class="text-xl">
                {% if message.tags == 'success' %}âœ…{% elif message.tags == 'error' %}âš ï¸{% else %}â„¹ï¸{% endif %}
            </span>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Balance Card -->
    <div
        class="bg-gradient-to-r from-melvins-dark to-black rounded-3xl p-6 sm:p-8 text-white shadow-xl mb-8 relative overflow-hidden">
        <div
            class="absolute right-0 top-0 opacity-10 w-48 h-48 bg-white rounded-full blur-3xl translate-x-10 -translate-y-10">
        </div>
        <div class="relative z-10 flex flex-col sm:flex-row justify-between items-center gap-4">
            <div>
                <p class="text-white/60 text-sm font-medium uppercase tracking-wider mb-1">Available Balance</p>
                <div class="text-4xl font-display font-bold">{{ profile.points }} <span
                        class="text-lg font-normal opacity-70">pts</span></div>
            </div>
            <div class="text-right text-xs opacity-70 bg-white/10 px-4 py-2 rounded-lg backdrop-blur-sm">
                <p class="mb-1">Daily Limit: {{ settings.daily_transfer_limit }}</p>
                <p>Remaining: {{ remaining_limit }}</p>
            </div>
        </div>
    </div>

    <!-- Transfer Form -->
    <div class="bg-white rounded-3xl border border-melvins-beige shadow-lg overflow-hidden mb-8">
        <div class="p-6 sm:p-8">
            <form method="post" class="space-y-6">
                {% csrf_token %}

                <div>
                    <label class="block text-sm font-bold text-melvins-dark mb-2">Recipient Phone Number</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-xl">ğŸ“±</span>
                        <input type="tel" name="recipient_phone"
                            class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-melvins-gold focus:border-melvins-gold outline-none transition"
                            placeholder="0712345678" required autofocus>
                    </div>
                    <p class="mt-2 text-xs text-melvins-dark/50">
                        If not registered, we'll send them an invite with the points!
                    </p>
                </div>

                <div>
                    <label class="block text-sm font-bold text-melvins-dark mb-2">Amount (Points)</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-xl">ğŸ’</span>
                        <input type="number" name="amount" min="{{ settings.min_transfer_amount }}"
                            max="{{ settings.max_transfer_amount }}"
                            class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-melvins-gold focus:border-melvins-gold outline-none transition"
                            placeholder="Min: {{ settings.min_transfer_amount }}" required>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-melvins-dark mb-2">Message (Optional)</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-xl">ğŸ’¬</span>
                        <input type="text" name="message" maxlength="200"
                            class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-melvins-gold focus:border-melvins-gold outline-none transition"
                            placeholder="Add a note meant for the recipient">
                    </div>
                </div>

                {% if settings.transfer_fee_percentage > 0 %}
                <div
                    class="bg-yellow-50 text-yellow-800 p-4 rounded-xl border border-yellow-200 text-sm flex items-start gap-3">
                    <span class="text-xl">âš ï¸</span>
                    <p>
                        <strong>Note:</strong> A {{ settings.transfer_fee_percentage }}% fee will be charged.
                        Example: Sending 100 points costs <strong>{{ 100|add:settings.transfer_fee_percentage
                            }}</strong> points total.
                    </p>
                </div>
                {% endif %}

                <button type="submit"
                    class="w-full py-4 bg-melvins-red text-white font-bold rounded-xl hover:bg-melvins-red-dark transition shadow-lg transform active:scale-[0.98] flex items-center justify-center gap-2">
                    <span>Send Points</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>
                </button>

            </form>
        </div>
    </div>

    <!-- How It Works & Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- How it Works -->
        <div class="bg-melvins-cream/30 border border-melvins-beige/50 rounded-2xl p-6">
            <h3 class="font-bold text-melvins-dark mb-4 flex items-center gap-2">
                <span>ğŸ“‹</span> How It Works
            </h3>
            <div class="text-sm text-melvins-dark/80 space-y-3">
                <div class="flex gap-2">
                    <span class="w-1.5 h-1.5 bg-melvins-gold rounded-full mt-1.5 flex-shrink-0"></span>
                    <p><strong>Registered Users:</strong> Transfer is instant and they get an SMS.</p>
                </div>
                <div class="flex gap-2">
                    <span class="w-1.5 h-1.5 bg-melvins-gold rounded-full mt-1.5 flex-shrink-0"></span>
                    <p><strong>New Users:</strong> We send an invite. Points are held until they join.</p>
                </div>
                <div class="flex gap-2">
                    <span class="w-1.5 h-1.5 bg-melvins-gold rounded-full mt-1.5 flex-shrink-0"></span>
                    <p>You can cancel pending invites anytime for a refund.</p>
                </div>
            </div>
        </div>

        <!-- Limits -->
        <div class="bg-gray-50 border border-gray-200 rounded-2xl p-6">
            <h3 class="font-bold text-melvins-dark mb-4 flex items-center gap-2">
                <span>âš–ï¸</span> Limits
            </h3>
            <ul class="text-sm text-melvins-dark/70 space-y-2">
                <li class="flex justify-between">
                    <span>Min Transfer:</span>
                    <span class="font-bold">{{ settings.min_transfer_amount }}</span>
                </li>
                <li class="flex justify-between">
                    <span>Max Transfer:</span>
                    <span class="font-bold">{{ settings.max_transfer_amount }}</span>
                </li>
                <li class="flex justify-between">
                    <span>Fee:</span>
                    <span class="font-bold">{{ settings.transfer_fee_percentage }}%</span>
                </li>
            </ul>
        </div>
    </div>

    <div class="mt-8 text-center">
        <a href="{% url 'club:transfer_history' %}"
            class="text-melvins-red font-bold hover:underline flex items-center justify-center gap-1">
            <span>ğŸ“œ</span> View Transfer History
        </a>
    </div>

</div>
{% endblock %}